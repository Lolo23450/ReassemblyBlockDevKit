<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reassembly Block Development Kit</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { display: flex; }
        .panel { width: 50%; padding: 10px; border: 1px solid #c0bcbc; margin-right: 10px; }
        .block-list button { display: block; margin: 6px; padding: 10px; width: 97%; }
        .attribute-section { margin-top: 10px; }
        label { width: 97%; display: block; margin-top: 5px; }
        input, select { width: 100%; padding: 5px; margin-bottom: 5px; }
        #exportBtn, #creditsBtn, #loadBtn { margin-top: 10px; padding: 10px; background: green; color: white; border: none; cursor: pointer; }
        #creditsBtn { background: blue; }
        #loadBtn { background-color: green;}
        #creditsPopup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid black; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5); }
        #closeCredits { margin-top: 10px; padding: 5px; background: red; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Reassembly Block Development Kit</h1>
    <button id="creditsBtn" onclick="showCredits()">Credits</button>
    <button id="exportBtn" onclick="exportBlocks()">Export blocks.lua</button>
    <button id="loadBtn" onclick="loadBlocks()">Load blocks.lua</button>
    <div id="creditsPopup">
        <h2>Credits</h2>
        <p>Developed by: Lolo</p>
        <p>Contributors: ChatGPT, Copilot</p>
        <button id="closeCredits" onclick="closeCredits()">Close</button>
    </div>
    <div class="container">
        <div class="panel block-list">
            <h3>Select a Block Type</h3>
            <button onclick="selectBlock('Armor')">Armor</button>
            <button onclick="selectBlock('Cannon')">Cannon</button>
            <button onclick="selectBlock('Laser')">Laser</button>
            <button onclick="selectBlock('Generator')">Generator</button>
            <button onclick="selectBlock('Command')">Command Module</button>
            <button onclick="selectBlock('Thruster')">Thruster</button>
            <button onclick="selectBlock('Factory')">Factory</button>
            <button onclick="selectBlock('Shield')">Shield</button>
        </div>
        <div class="panel">
            <h3>Block Attributes</h3>
            <div id="blockattributes"></div>
            <div id="attributes"></div>
        </div>
        <div class="panel block-list">
            <h3>Created Blocks</h3>
            <ul id="blockList"></ul>
        </div>
    </div>

    <script>
        let blocks = [];
        
        function showCredits() {
            document.getElementById('creditsPopup').style.display = 'block';
        }

        function closeCredits() {
            document.getElementById('creditsPopup').style.display = 'none';
        }

        function selectBlock(typeargs, generalargs) {
            renderAttributes({ typeargs, generalargs, name: `New ${typeargs}`, shape: "SQUARE", size: 1, id: blocks.length + 1, group: 1, fillColor1: "#d4d4d4", fillColor2: "#959696", lineColor: "#686869", capacity: 0, cannondmg: 20, cannonrounds: 4, cannonrange: 800, cannonvel: 1000, cannonpower: 7, laserdmg: 100, laserrange: 700, laserwidth: 2, laserpower:5 , turreted: "True", health: 1, powerCapacity: 300, generatorCapacityPerSec: 75, faction: 1, thrust: 3000, points: 0, shieldradius: 40, shieldpower: 0, shieldhealth: 300, shieldregen: 100, shielddelay: 2, shieldcolor: "#00ff00", shielddamagedColor: "#ff0000" });
        }

        function renderAttributes(block) {
            const featureAttributesDiv = document.getElementById('attributes');
            const blockAttributesDiv = document.getElementById('blockattributes');
            featureAttributesDiv.innerHTML = `<h4>${block.typeargs} Attributes</h4>`;
            blockAttributesDiv.innerHTML = `<h5>General Attributes</h5>`;
            let blockAttributesHTML = `<label>Name: <input type="text" id="name" value="${block.name}"></label>`;
            blockAttributesHTML += `<label>Block ID: <input type="number" id="id" value="${block.id}"></label>`;
            blockAttributesHTML += `<label>Group/Faction ID: <input type="text" id="group" value="${block.group}"></label>`;
            blockAttributesHTML += `<label>Shape: <input type="text" id="shape" value="${block.shape}"></label>`;
            blockAttributesHTML += `<label>Size: <input type="number" id="size" value="${block.size}"></label>`;
            blockAttributesHTML += `<label>Health Multiplier: <input type="number" id="health" value="${block.health}"></label>`;
            blockAttributesHTML += `<label>Capacity: <input type="number" id="capacity" value="${block.capacity}"></label>`;
            blockAttributesHTML += `<label>P Cost: <input type="number" id="points" value="${block.points}"></label>`;
            blockAttributesHTML += `<label>Fill Color 1: <input type="color" id="fillColor1" value="${block.fillColor1}"></label>`;
            blockAttributesHTML += `<label>Fill Color 2: <input type="color" id="fillColor2" value="${block.fillColor2}"></label>`;
            blockAttributesHTML += `<label>Line Color: <input type="color" id="lineColor" value="${block.lineColor}"></label>`;
            let attributesHTML = '';
            
            if (block.typeargs === 'Cannon') {
                attributesHTML += `
                    <label>Turreted (True/False): <input type="text" id="turreted" value="${block.turreted}"></label>
                    <label>Damage: <input type="number" id="damage" value="${block.cannondmg}"></label>
                    <label>Rounds per Sec: <input type="number" id="roundsPerSec" value="${block.cannonrounds}"></label>
                    <label>Range: <input type="number" id="range" value="${block.cannonrange}"></label>
                    <label>Shot Velocity: <input type="number" id="muzzleVel" value="${block.cannonvel}"></label>
                    <label>Power: <input type="number" id="power" value="${block.cannonpower}"></label>
                `;
            } else if (block.typeargs === 'Laser') {
                attributesHTML += `
                    <label>Turreted (True/False): <input type="text" id="turreted" value="${block.turreted}"></label>
                    <label>Damage: <input type="number" id="laserdamage" value="${block.laserdmg}"></label>
                    <label>Range: <input type="number" id="laserrange" value="${block.laserrange}"></label>
                    <label>Width: <input type="number" id="laserwidth" value="${block.laserwidth}"></label>
                    <label>Power: <input type="number" id="laserpower" value="${block.laserpower}"></label>
                `;
            } else if (block.typeargs === 'Generator') {
                attributesHTML += `
                    <label>Power Capacity: <input type="number" id="powerCapacity" value="${block.powerCapacity}"></label>
                    <label>Generation per Sec: <input type="number" id="generatorCapacityPerSec" value="${block.generatorCapacityPerSec}"></label>
                `;
            } else if (block.typeargs === 'Command') {
                attributesHTML += `
                    <label>Faction ID: <input type="number" id="faction" value="${block.faction}"></label>
                `;
            } else if (block.typeargs === 'Thruster') {
                attributesHTML += `
                    <label>Thruster Force: <input type="number" id="thrust" value="${block.thrust}"></label>
                `;
            } else if (block.typeargs === 'Shield') {
                attributesHTML += `
                    <label>Radius: <input type="number" id="radius" value="${block.shieldradius}"></label>
                    <label>Power: <input type="number" id="power" value="${block.shieldpower}"></label>
                    <label>Health: <input type="number" id="shieldhealth" value="${block.shieldhealth}"></label>
                    <label>Health Regen per Sec: <input type="number" id="regen" value="${block.shieldregen}"></label>
                    <label>Delay: <input type="number" id="delay" value="${block.shielddelay}"></label>
                    <label>Color: <input type="color" id="color" value="${block.shieldcolor}"></label>
                    <label>Damaged Color: <input type="color" id="damagedColor" value="${block.shielddamagedColor}"></label>
                `;
            }

            attributesHTML += `<button onclick="saveBlock()">Add Block</button>`;
            blockAttributesDiv.innerHTML += blockAttributesHTML;
            featureAttributesDiv.innerHTML += attributesHTML;
        }

        function saveBlock() {
            let block = {
                typeargs: document.querySelector('h4').textContent.split(' ')[0],
                generalargs: document.querySelector('h5').textContent.split(' ')[0],
                name: document.getElementById('name').value,
                shape: document.getElementById('shape').value,
                size: document.getElementById('size').value,
                group: document.getElementById('group').value,
                points: document.getElementById('points').value,
                id: document.getElementById('id').value,
                health: document.getElementById('health').value,
                capacity: document.getElementById('capacity').value,
                points: document.getElementById('points').value,
                fillColor1: document.getElementById('fillColor1').value,
                fillColor2: document.getElementById('fillColor2').value,
                lineColor: document.getElementById('lineColor').value,
            };
            if (block.typeargs === "Cannon") {
                Object.assign(block, {
                    cannondmg: document.getElementById('damage').value,
                    cannonrounds: document.getElementById('roundsPerSec').value,
                    cannonrange: document.getElementById('range').value,
                    cannonvel: document.getElementById('muzzleVel').value,
                    cannonpower: document.getElementById('power').value,
                    turreted: document.getElementById('turreted').value,
                });
            } else if (block.typeargs === "Generator") {
                Object.assign(block, {
                    powerCapacity: document.getElementById('powerCapacity').value,
                    generatorCapacityPerSec: document.getElementById('generatorCapacityPerSec').value,
                });
            } else if (block.typeargs === "Command") {
                Object.assign(block, {
                    faction: document.getElementById('faction').value,
                });
            } else if (block.typeargs === "Thruster") {
                Object.assign(block, {
                    thrust: document.getElementById('thrust').value,
                });
            } else if (block.typeargs === "Laser") {
                Object.assign(block, {
                    laserdmg: document.getElementById('laserdamage').value,
                    laserrange: document.getElementById('laserrange').value,
                    laserwidth: document.getElementById('laserwidth').value,
                    laserpower: document.getElementById('laserpower').value,
                    turreted: document.getElementById('turreted').value,
                });
            } else if (block.typeargs === "Shield") {
                Object.assign(block, {
                    shieldradius: document.getElementById('radius').value,
                    shieldpower: document.getElementById('power').value,
                    shieldhealth: document.getElementById('shieldhealth').value,
                    shieldregen: document.getElementById('regen').value,
                    shielddelay: document.getElementById('delay').value,
                    shieldcolor: document.getElementById('color').value,
                    shielddamagedColor: document.getElementById('damagedColor').value,
                });
            }
            blocks.push(block);
            updateBlockList();
        }

        function deleteBlock(index) {
            if (confirm("Are you sure you want to delete this block?")) {
                blocks.splice(index, 1);
                updateBlockList();
            }
        }

        function cloneBlock(index) {
        const blockToClone = blocks[index];
        const clonedBlock = { 
            ...blockToClone, 
            id: blocks.length + 1, 
            name: `${blockToClone.name} (Clone)`,
            shape: blockToClone.shape,
            size: blockToClone.size,
            group: blockToClone.group,
            fillColor1: blockToClone.fillColor1,
            fillColor2: blockToClone.fillColor2,
            lineColor: blockToClone.lineColor,
            capacity: blockToClone.capacity,
            points: blockToClone.points,
            cannondmg: blockToClone.cannondmg,
            cannonrounds: blockToClone.cannonrounds,
            cannonrange: blockToClone.cannonrange,
            cannonvel: blockToClone.cannonvel,
            cannonpower: blockToClone.cannonpower,
            laserdmg: blockToClone.laserdmg,
            laserrange: blockToClone.laserrange,
            laserwidth: blockToClone.laserwidth,
            laserpower: blockToClone.laserpower,
            turreted: blockToClone.turreted,
            health: blockToClone.health,
            powerCapacity: blockToClone.powerCapacity,
            generatorCapacityPerSec: blockToClone.generatorCapacityPerSec,
            faction: blockToClone.faction,
            thrust: blockToClone.thrust,
            shieldradius: blockToClone.shieldradius,
            shieldpower: blockToClone.shieldpower,
            shieldhealth: blockToClone.shieldhealth,
            shieldregen: blockToClone.shieldregen,
            shielddelay: blockToClone.shielddelay,
            shieldcolor: blockToClone.shieldcolor,
            shielddamagedColor: blockToClone.shielddamagedColor
        };
        blocks.push(clonedBlock);
        updateBlockList();
    }

        function updateBlockList() {
            const blockList = document.getElementById('blockList');
            blockList.innerHTML = '';
            blocks.forEach((block, index) => {
                let button = document.createElement('button');
                button.textContent = `${block.name} (${block.typeargs})`;
                button.onclick = () => renderAttributes(blocks[index]);
                blockList.appendChild(button);
                
                let deleteBtn = document.createElement('button');
                deleteBtn.textContent = "Delete";
                deleteBtn.style.background = "red";
                deleteBtn.style.color = "white";
                deleteBtn.onclick = () => deleteBlock(index);
                blockList.appendChild(deleteBtn);

                let cloneBtn = document.createElement('button');
                cloneBtn.textContent = "Clone";
                cloneBtn.style.background = "orange";
                cloneBtn.style.color = "white";
                cloneBtn.onclick = () => cloneBlock(index);
                blockList.appendChild(cloneBtn);
            });
        }

    function hexToLuaColor(hex) {
        return '0x' + hex.slice(1);
    }

    function exportBlocks() {
        let luaCode = `{\n`;
        blocks.forEach((block) => {
            luaCode += `    {${block.id},\n`;
            luaCode += `        group = ${block.group},\n`;
            luaCode += `        name = "${block.name}",\n`;
            luaCode += `        fillColor1 = ${hexToLuaColor(block.fillColor1)},\n`;
            luaCode += `        fillColor2 = ${hexToLuaColor(block.fillColor2)},\n`;
            luaCode += `        lineColor = ${hexToLuaColor(block.lineColor)},\n`;
            luaCode += `        capacity = ${block.capacity},\n`;
            luaCode += `        shape = ${block.shape},\n`;
            luaCode += `        size = ${block.size},\n`;
            luaCode += `        points = ${block.points},\n`;
            if (block.typeargs === 'Cannon') {
                if (block.turreted === 'True') {
                    luaCode += `        features = PALETTE|CANNON|TURRET,\n`;
                } else if (block.turreted === 'False') {
                    luaCode += `        features = PALETTE|CANNON,\n`;
                }
                luaCode += `        cannon = {\n`;
                luaCode += `            damage = ${block.cannondmg},\n`;
                luaCode += `            roundsPerSec = ${block.cannonrounds},\n`;
                luaCode += `            range = ${block.cannonrange},\n`;
                luaCode += `            muzzleVel = ${block.cannonvel},\n`;
                luaCode += `            power = ${block.cannonpower},\n`;
                luaCode += `        },\n`;
            } else if (block.typeargs === 'Laser') {
                if (block.turreted === 'True') {
                    luaCode += `        features = PALETTE|LASER|TURRET,\n`;
                } else if (block.turreted === 'False') {
                    luaCode += `        features = PALETTE|LASER,\n`;
                }
                luaCode += `        laser = {\n`;
                luaCode += `            damage = ${block.laserdmg},\n`;
                luaCode += `            range = ${block.laserrange},\n`;
                luaCode += `            width = ${block.laserwidth},\n`;
                luaCode += `            power = ${block.laserpower},\n`;
                luaCode += `        },\n`;
            } else if (block.typeargs === 'Armor') {
                luaCode += `        features = PALETTE,\n`;
                luaCode += `        durability = ${block.health},\n`;
            } else if (block.typeargs === 'Generator') {
                luaCode += `        features = PALETTE|GENERATOR,\n`;
                luaCode += `        powerCapacity = ${block.powerCapacity},\n`;
                luaCode += `        generatorCapacityPerSec = ${block.generatorCapacityPerSec},\n`;
            } else if (block.typeargs === 'Command') {
                luaCode += `        features = COMMAND|ASSEMBLER,\n`;
                luaCode += `        command = {\n`;
                luaCode += `            faction = ${block.faction},\n`;
                luaCode += `        },\n`;
            } else if (block.typeargs === 'Thruster') {
                luaCode += `        features = PALETTE|THRUSTER,\n`;
                luaCode += `        thrusterForce = ${block.thrust},\n`;
            } else if (block.typeargs === 'Factory') {
                luaCode += `        features = PALETTE|FACTORY,\n`;
            } else if (block.typeargs === 'Shield') {
                luaCode += `        features = PALETTE|SHIELD,\n`;
                luaCode += `        shield = {\n`;
                luaCode += `            radius = ${block.shieldradius},\n`;
                luaCode += `            power = ${block.shieldpower},\n`;
                luaCode += `            health = ${block.shieldhealth},\n`;
                luaCode += `            regen = ${block.shieldregen},\n`;
                luaCode += `            delay = ${block.shielddelay},\n`;
                luaCode += `            color = ${hexToLuaColor(block.shieldcolor)},\n`;
                luaCode += `            damagedColor = ${hexToLuaColor(block.shielddamagedColor)},\n`;
                luaCode += `        },\n`;
            }

            luaCode += `    },\n`;
        });
        luaCode += `}`;

        const blob = new Blob([luaCode], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = 'blocks.lua';
        document.body.appendChild(a);
        a.click();

        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function loadBlocks() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.lua';
        input.onchange = async (event) => {
            const file = event.target.files[0];
            if (file) {
                const text = await file.text();
                parseLuaBlocks(text);
            }
        };
        input.click();
    }

    function parseLuaBlocks(luaCode) {
    const blockRegex = /{\s*(\d+),([\s\S]*?)\s*},/g;
    let match;

    blocks = []; // Clear existing blocks

    while ((match = blockRegex.exec(luaCode)) !== null) {
        let block = { id: parseInt(match[1]), typeargs: "", turreted: "False" };
        let attributes = match[2];

        // Extract key-value pairs
        attributes.split("\n").forEach(line => {
            let keyValue = line.match(/\s*(\w+)\s*=\s*(.*?),/);
            if (keyValue) {
                let key = keyValue[1].trim();
                let value = keyValue[2].trim().replace(/"|,/g, "");

                // Handle special cases
                if (key === "name" || key === "shape") {
                    block[key] = value;
                } else if (key === "features") {
                    if (value.includes("CANNON")) block.typeargs = "Cannon";
                    if (value.includes("LASER")) block.typeargs = "Laser";
                    if (value.includes("TURRET")) block.turreted = "True";
                    if (value.includes("GENERATOR")) block.typeargs = "Generator";
                    if (value.includes("COMMAND")) block.typeargs = "Command";
                    if (value.includes("THRUSTER")) block.typeargs = "Thruster";
                    if (value.includes("FACTORY")) block.typeargs = "Factory";
                    if (value.includes("SHIELD")) block.typeargs = "Shield";
                } else if (key === "cannon") {
                    let cannonStats = value.match(/damage\s*=\s*(\d+).*?roundsPerSec\s*=\s*(\d+).*?range\s*=\s*(\d+)/s);
                    if (cannonStats) {
                        block.cannondmg = parseInt(cannonStats[1]);
                        block.cannonrounds = parseInt(cannonStats[2]);
                        block.cannonrange = parseInt(cannonStats[3]);
                    }
                } else if (key === "laser") {
                    let laserStats = value.match(/damage\s*=\s*(\d+).*?range\s*=\s*(\d+)/s);
                    if (laserStats) {
                        block.laserdmg = parseInt(laserStats[1]);
                        block.laserrange = parseInt(laserStats[2]);
                    }
                } else if (!isNaN(value)) {
                    block[key] = parseFloat(value);
                }
            }
        });

        blocks.push(block);
    }

    updateBlockList(); // Refresh UI
}

</script>
</body>
</html>